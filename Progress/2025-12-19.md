# Link-level CO₂ Mapping 

## Objective
This study aims to visualize link-level CO₂ emissions using CAN/GPS data.
The goal is to separate traffic volume effects from road link characteristics.

## Data
- Toyota CAN/GPS data (parquet format, about 1 Hz)
- Main variables:
  - linkid (CAN map-matching link ID)
  - gps_timestamp
  - mmlatitude, mmlongitude
  - fuelconsumption (fuel rate, L/h)
  - vin_sha256 (vehicle ID)

Each file includes all vehicles observed during the analysis period.

## Method
1. CO₂ calculation (per record)
   - fuelconsumption is treated as fuel rate (L/h).
   - Fuel per second = fuelconsumption / 3600.
   - CO₂ emissions are estimated assuming gasoline vehicles
     (2.32 kg-CO₂/L).
   - For electric vehicles (EVs), CO₂ emissions are set to zero.

2. Link geometry construction
   - Road link shapes are built directly from CAN map-matched
     coordinates (mmlatitude, mmlongitude) grouped by linkid.
   - This avoids ID mismatch problems with external road
     network data.

3. Link-level aggregation
   - Total CO₂ emissions per link (g).
   - Number of vehicles passing each link (unique vin_sha256).
   - Link length (km), calculated from line length in a
     projected CRS (EPSG:6677).

4. CO₂ intensity indicator
   CO₂ intensity (g/veh-km) is defined as:
   Total CO₂ (g) / (link length (km) × number of vehicles).
   This represents average CO₂ emissions per vehicle per kilometer.

## Visualization
- All links are rasterized using Datashader.
- The raster image is overlaid on a folium map using ImageOverlay.
- This allows interactive pan and zoom while visualizing the full network.

Maps created:
- Total CO₂ Emissions by Road Link (g)
  ![BCD1B9C7-64BC-43F5-8E0D-B605DBB00877](https://github.com/user-attachments/assets/0e880ba5-c33b-47b7-be1d-aca2f4f525d3)

- CO₂ Emission Intensity by Road Link (g/veh-km)

## Preliminary Findings
- Total CO₂ highlights links with high traffic volume.
- CO₂ intensity highlights links with inefficient driving conditions.
- The two indicators show different aspects of environmental impact.

## Next Steps
- Check assumptions on fuel type and vehicle type (ICE / HEV / EV).
- Improve link geometry construction.
- Compare high-emission links using total emissions and intensity.
- Extend the analysis to time-of-day and route choice (UE vs SO).
