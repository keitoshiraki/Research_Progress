# SOの結果（Sioux Falls）（混雑外部性のみ）

## 概要
**混雑外部性のみを考慮した System Optimum（SO）配分**を実装し、  
User Equilibrium（UE）との結果比較を行った。

- 対象ネットワーク：Sioux Falls  
- 配分方法：Logit-SUE（k-shortest paths + MSA）  
- SO の定義：**社会限界費用**に基づく配分  

SO におけるリンク一般化費用は以下で定義される。

$$
c_a^{SO}(x_a) = t_a(x_a) + x_a \frac{dt_a}{dx_a}
$$

BPR 関数は次式を用いた。

$$
t_a(x_a) = t_{0,a}\left(1 + \alpha \left(\frac{x_a}{c_a}\right)^\beta \right)
$$

---

## 評価指標
本検証では、以下の指標を用いて UE と SO を比較した。

- **TotalFlow**  

$$
\sum_a x_a
$$

ネットワーク全体でのリンク通過回数の総和  
（OD 需要ではなく、リンク通過量の合計）

- **Total Travel Time (TTT)**

$$
\sum_a x_a \, t_a(x_a)
$$

- **Marginal Cost Total (TMC)**（SOで用いた限界費用の総和）

$$
\sum_a x_a \, c_a^{SO}(x_a)
$$

- **Congestion Externality (EXT)**（混雑外部性の総量）

$$
\sum_a x_a\left(c_a^{SO}(x_a)-t_a(x_a)\right)=
\sum_a x_a^2\frac{dt_a}{dx_a}
$$

- **Average Travel Time**

$$
\frac{\sum_a x_a \, t_a(x_a)}{\sum_a x_a}
$$

1 台あたりの平均旅行時間

- **Externality per Flow（外部性の平均）**

$$
\frac{\sum_a x_a\left(c_a^{SO}(x_a)-t_a(x_a)\right)}{\sum_a x_a}
$$

---

## UE と SO（混雑外部性）の比較結果

| 指標 | UE | SO (congestion) | SO − UE | SO / UE |
|---|---:|---:|---:|---:|
| TotalFlow | 8.998×10⁵ | 9.417×10⁵ | +4.19×10⁴ | 1.047 |
| Total Travel Time (TTT) | 7.615×10⁶ | 7.716×10⁶ | +1.01×10⁵ | 1.013 |
| Total Marginal Cost (TMC) | 2.404×10⁷ | 2.381×10⁷ | −2.28×10⁵ | 0.991 |
| Congestion Externality (EXT) | 1.642×10⁷ | 1.609×10⁷ | −3.29×10⁵ | 0.980 |
| Average Travel Time | 8.46 | **8.19** | **−0.27** | **0.968** |
| EXT per TotalFlow | 18.25 | **17.09** | **−1.16** | **0.936** |

---

## 結果の解釈
- SO（混雑外部性）では、**限界費用に基づいて混雑の大きいリンクが相対的に回避**され、交通がネットワーク全体に分散した。  
- その結果：
  - リンク通過量の総和（TotalFlow）は増加
  - 総旅行時間（TTT）はわずかに増加
  - **平均旅行時間（1台あたり）は約 3% 短縮**
  - **混雑外部性（EXT）は約 2% 減少**（SO/UE = 0.980）
  - **外部性の平均（EXT/TotalFlow）は約 6% 減少**（SO/UE = 0.936）

本研究では、**限界費用に基づく SO を確率的経路選択（Logit-SUE）として実装**している。  
そのため、厳密な総旅行時間最小化は保証されない一方で、  
混雑回避行動により **混雑外部性（EXT）および外部性の平均が低下**することを確認した。

---

## 本結果の位置づけ
- 本結果は、今後導入する外部性  
  （CO₂排出量、事故リスク、騒音等）の **ベースライン**と位置づける。
- 次段階では、SO の一般化費用を以下のように拡張する。

$$
c_a =
t_a(x_a) + x_a \frac{dt_a}{dx_a}+ \lambda_{CO_2} CO_{2,a}+ \lambda_{acc} Risk_a+ \lambda_{noise} Noise_a
$$
