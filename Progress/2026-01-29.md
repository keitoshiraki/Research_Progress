# SOの結果（Sioux Falls）（混雑外部性のみ）

## 概要
**混雑外部性のみを考慮した System Optimum（SO）配分**を実装し、  
User Equilibrium（UE）との結果比較を行った。

- 対象ネットワーク：Sioux Falls  
- 配分方法：Logit-SUE（k-shortest paths + MSA）  
- SO の定義：**社会限界費用**に基づく配分  

SO におけるリンク一般化費用は以下で定義される。

$$
c_a^{SO}(x_a) = t_a(x_a) + x_a \frac{dt_a}{dx_a}
$$

BPR 関数は次式を用いた。

$$
t_a(x_a) = t_{0,a}\left(1 + \alpha \left(\frac{x_a}{c_a}\right)^\beta \right)
$$

> 本結果では、自由流時間および旅行時間の単位として **分（minute）** を用いている。

---

## 評価指標
本検証では、以下の指標を用いて UE と SO を比較した。

- **TotalFlow**  

$$
\sum_a x_a
$$

ネットワーク全体でのリンク通過回数の総和  
（OD 需要ではなく、リンク通過量の合計）

- **Total Travel Time (TTT)**

$$
\sum_a x_a \, t_a(x_a)
$$

（単位：veh・min）

- **Marginal Cost Total (TMC)**（SOで用いた限界費用の総和）

$$
\sum_a x_a \, c_a^{SO}(x_a)
$$

（単位：veh・min）

- **Congestion Externality (EXT)**（混雑外部性の総量）

$$
\sum_a x_a\left(c_a^{SO}(x_a)-t_a(x_a)\right)=
\sum_a x_a^2\frac{dt_a}{dx_a}
$$

（単位：veh・min）

- **Average Travel Time**

$$
\frac{\sum_a x_a \, t_a(x_a)}{\sum_a x_a}
$$

1 台あたりの平均旅行時間（単位：min）

- **Externality per Flow（外部性の平均）**

$$
\frac{\sum_a x_a\left(c_a^{SO}(x_a)-t_a(x_a)\right)}{\sum_a x_a}
$$

1 台あたりの混雑外部性（単位：min）

---

## UE と SO（混雑外部性）の比較結果（minute 単位）

| 指標 | UE | SO (congestion) | SO − UE | SO / UE |
|---|---:|---:|---:|---:|
| TotalFlow | 9.101×10⁵ | 9.427×10⁵ | +3.26×10⁴ | 1.036 |
| Total Travel Time (TTT) | 4.635×10⁶ | 4.642×10⁶ | +7.19×10³ | 1.002 |
| Total Marginal Cost (TMC) | 1.465×10⁷ | 1.433×10⁷ | −3.18×10⁵ | 0.978 |
| Congestion Externality (EXT) | 1.002×10⁷ | 9.693×10⁶ | −3.25×10⁵ | 0.968 |
| Average Travel Time | 5.09 | **4.92** | **−0.17** | **0.967** |
| EXT per TotalFlow | 11.01 | **10.28** | **−0.73** | **0.934** |

---

## 結果の解釈
- SO（混雑外部性）では、**限界費用に基づいて混雑の大きいリンクが相対的に回避**され、交通がネットワーク全体に分散した。  
- その結果：
  - リンク通過量の総和（TotalFlow）は増加
  - 総旅行時間（TTT）はほぼ変化しない
  - **平均旅行時間（1台あたり）は約 3% 短縮**（SO/UE = 0.967）
  - **混雑外部性（EXT）は約 3% 減少**（SO/UE = 0.968）
  - **1 台あたり外部性（EXT/TotalFlow）は約 7% 減少**（SO/UE = 0.934）

本研究では、**限界費用に基づく SO を確率的経路選択（Logit-SUE）として実装**している。  
そのため、厳密な総旅行時間最小化は保証されない一方で、  
混雑回避行動により **混雑外部性およびその平均が一貫して低下**することを確認した。

---

## 本結果の位置づけ
- 本結果は、今後導入する外部性  
  （CO₂排出量、事故リスク、騒音等）の **ベースライン**と位置づける。
- 次段階では、SO の一般化費用を以下のように拡張する。

$$
c_a =
t_a(x_a)+ x_a \frac{dt_a}{dx_a}+ \lambda_{CO_2} CO_{2,a}+ \lambda_{acc} Risk_a+ \lambda_{noise} Noise_a
$$
