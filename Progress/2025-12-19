# Progress Update: Link-level CO₂ Mapping using Toyota CAN/GPS

## Objective
To quantify and visualize **link-level CO₂ emissions** using Toyota CAN/GPS data, distinguishing **traffic load effects** from **structural inefficiencies of road links**, under notebook-only execution constraints.

---

## Data
- Toyota CAN/GPS data (parquet format, ~1 Hz)
- Key variables:
  - `linkid` (CAN map-matching link ID)
  - `gps_timestamp`
  - `mmlatitude`, `mmlongitude`
  - `fuelconsumption` (instantaneous fuel rate, L/h)
  - `vin_sha256` (vehicle identifier)

Each parquet file contains all observed vehicles for a given analysis period.

---

## Method
1. **CO₂ estimation (record level)**  
   - `fuelconsumption` is treated as an instantaneous fuel rate (L/h).  
   - Fuel per second = `fuelconsumption / 3600`.  
   - CO₂ emissions are estimated assuming gasoline vehicles (2.32 kg-CO₂/L).

2. **Link geometry construction**  
   - Road link geometries are constructed directly from CAN map-matched coordinates (`mmlatitude`, `mmlongitude`) grouped by CAN `linkid`.
   - This avoids unreliable ID matching with external road network data (e.g., BLink Lv02).

3. **Link-level aggregation**  
   - Total CO₂ emissions per link (g).
   - Number of traversing vehicles (unique `vin_sha256`).
   - Link length (km), computed from LineString length in a projected CRS (EPSG:6677).

4. **Emission intensity indicator**  
\[
\text{CO₂ intensity (g/veh-km)} =
\frac{\text{Total CO₂ (g)}}
{\text{Link length (km)} \times \text{Number of vehicles}}
\]
   - This indicator removes pure traffic volume effects and captures per-vehicle emission efficiency.

---

## Visualization
- Full-network visualization is achieved by:
  - Rasterizing all links using **Datashader**
  - Overlaying the raster on a **folium basemap** using `ImageOverlay`
- This enables interactive pan/zoom while rendering all links within a notebook environment.

**Outputs**
- *Total CO₂ Emissions by Road Link (g)*
- *CO₂ Emission Intensity by Road Link (g/veh-km)*

---

## Preliminary Insights
- Total CO₂ highlights links with high traffic demand.
- CO₂ intensity reveals links with potentially inefficient driving conditions, even when traffic volume is moderate.
- The two indicators provide complementary perspectives on environmental externalities.

---

## Next Steps
- Validate fuel-type and vehicle-type assumptions (ICE / HEV / EV).
- Improve link geometry construction and sampling strategy.
- Compare hotspots between total emissions and intensity metrics.
- Extend analysis to time-of-day differences and UE vs SO discussions.
